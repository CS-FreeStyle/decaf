#!/bin/bash

TEST_NAME="badpre"
DCC="../src/dcc"
CMP="diff -w"
WC="wc -c"
INFILE=${TEST_NAME}.frag
REFFILE=${TEST_NAME}.out
ERRFILE=${TEST_NAME}.err
OUTFILE=${TEST_NAME}.put

RETVAL=0

$DCC < $INFILE 2> $ERRFILE > $OUTFILE
if ${CMP} -s $OUTFILE $REFFILE; then
	:
else
	echo "Output differs from reference file"
	RETVAL=1
fi

if test -s $ERRFILE; then
	echo "stderr is non-empty"
	RETVAL=2
fi

exit $RETVAL
